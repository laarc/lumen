#!/bin/sh

DIR="`pwd`"
cd "`dirname "$0"`"
USR="$HOME"
HOME="`pwd`"
cd "$DIR"

if [ ! -z $LUMEN_HOST ]
then
    HOST=$LUMEN_HOST
elif luajit -v > /dev/null 2>&1
then
    HOST=luajit
elif lua -v > /dev/null 2>&1
then
    HOST=lua
elif node -v > /dev/null 2>&1
then
    HOST=node
else
    echo no host found
fi

case $HOST in
    node*)
        CODE=lumen.js
        export NODE_PATH="$HOME:$DIR/lib";;
    *)
        CODE=lumen.lua
        export LUA_PATH="$HOME/?.lua;$DIR/lib/?.lua;;";;
esac

export USER_HOME="$USR"
export LUMEN_DIR="$DIR"
cd "$HOME/.."
export LUMEN_HOME="`pwd`"
cd "$DIR"

exec $HOST "$HOME/$CODE" "$@"
